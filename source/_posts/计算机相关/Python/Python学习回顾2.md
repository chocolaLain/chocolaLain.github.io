---
layout: 第四章
title: Python学习回顾2-函数与程序结构
date: 2018-11-13 20:28:03
tags:
    - python
categories: Python
---
资源：[用Python做科学计算](http://bigsec.net/b52/scipydoc/index.html#)
[廖雪峰的官方网站](https://www.liaoxuefeng.com/)

##  4.1.1作用域与函数定义

1.出现在Python程序文件的表层创建的名字(无论是函数名还是变量名)都具有全局作用域.
而模块里的函数定义了一个局部作用域(范围就是函数的体)

<!-- more -->

2.Python的一条基本原则是赋值及定义,一个作用域里面一个变量只有一个定义,在这个作用域里的任何地方,只要提到变量名都是使用同一个定义.

  如果全局定义域里面x有了定义,而某个函数里面又给x重新定义,那么这个函数里面用这个作用域里面的局部定义,即x的局部定义遮蔽全局定义,没有局部定义的话也可以直接使用全局定义.
3.
```Python
x = 1
def fun2():
    y = x # 这时x无定义
    x = 2 # 当函数体里面出现过x的赋值定义时,无论其他的x赋值定义处在什么位置,都必须把这个x当做局部变量,否则下面再用到x的时候会出现不知道到底用全局变量还是局部变量的矛盾.
    return x + y # 报错 local variable 'x' referenced before assignment
```

##  4.1.2 环境和状态
名字和环境
* python解释器为程序提供了记录信息的能力（使用赋值变量，调用定义了的函数），相关的概念是环境与状态
* 对不同的对象，解释器的输出可能有不同的形式和意义（例如True、id、float）
* **所有有记录的名字构成了程序运行的环境。**（没默认赋值 没赋值 没定义的函数没法用）
* 实际上函数的退出也会使一些变量的定义消失
* del 变量描述，交互式的计算方式下啊啊，可以删除一些不再需要的名字，python程序里也可以用过，但这种使用不太多见。

状态
* 所有有定义的名字及其关联值，构成了当时程序执行的状态（简称程序状态或状态）。
* 程序执行时的行为受到当时状态的影响，甚至完全由当时的状态决定：表达式里通常有变量，这使表达式依赖于相关变量，其值依赖于当时的状态（当时有关变量的状态值）。例如for if while
* 注意，即使环境不变（有定义的名字不变），其中名字的关联值也可能改变。
* 赋值就是修改程序的状态（出费用变量当前值重新赋值）。也就是说，语句的执行效果以来于当时的状态，但同时也可能改变状态（甚至改变环境）。
* 谈到了build ins
* 调用并不修改状态

程序执行与状态
* x = y + 1 可能改变状态（除非y + 1的值恰好与当时x的值相同）
* 有些操作还会改变环境，例如赋值、def、del
* 编程时，有关状态与环境需要关心两个问题：
    - 现在有哪些可以用的（有意义的）名字？
    - 它们在当前状态中的关联值是什么？
*当前状态*就是程序执行到这里时所有可用变量及其取值的全体。

## 4.1.3 程序执行时的环境变化
* 造成环境变化最重要情况是函数调用

### 名字空间（namespace）
* [谈谈自己的理解:python中闭包，闭包的实质](https://www.cnblogs.com/s-1314-521/p/9763376.html)
* [python中list作为全局变量无需global声明的原因](https://www.cnblogs.com/yym2013/p/5915980.html)
* [实例讲解Python中global语句下全局变量的值的修改](https://www.jb51.net/article/86765.htm)
* [详解python命名空间和作用域
](https://www.cnblogs.com/zhangxinhe/p/6963462.html) 前面的例子可以看看，静态作用域规则可以多看看
>命名空间在python解释器中是以字典的形式存在的，是以一种可以看得见摸得着的实体存在的。作用域是python解释器定义的一种规则，该规则确定了运行时变量查找的顺序，是一种形而上的虚的规定。
 python解释器动态执行过程中，对遇到的变量进行解释时，是按照一条固定的作用域链查找解释的，又称为LEGB法则。

 * [python 作用域与名称空间?](https://www.zhihu.com/question/29826740) 里面的两篇文章可以看看
 * [Python命名空间和作用域窥探](http://blog.cipherc.com/2015/04/25/python_namespace_and_scope/#assignment-rule)
     - 这篇解释命名空间和作用域更加详细，多看看
     - 涉及到了直接访问和属性访问
     - 作用域可以嵌套。比如模块导入时。这也是为什么不推荐使用 from a_module import * 的原因，导入的变量可能被当前模块覆盖。
     - 之后再去了解一下里面谈到的列表推导式和生成表达式之类的。 
* 标准函数dir用于检查名字空间里的名字，默认检查当前名字空间。可以用来看一些名字空间和名字。
* p130的例子可以看看
* 全剧名字空间是当前名字空间，所有操作默认地在这个名字空间里产生效果。内置名字空间是全局名字空间的外围名字空间（enclosing namespace），他也是最外围的名字空间，总是最后考虑和使用。

### 环境的结构
* 对print赋值并没有改变内置名字空间里的print及其关联（内置函数）

### 函数的定义和调用
* 函数对象就是一种可以调用执行的对象，同样通过名字使用
* y = fun(x + 1) 解释器首先找到fun1的函数对象，在求出实参表达式的值2而后调用函数，希望把函数的执行得到结果赋给变量z
* 函数调用前后环境变化情况：执行中遇到了一个函数调用，解释器就会为其建立一个新的名字空间，并建立他与外围的联系（以被调用函数的定义所在的作用域对应的名字空间为其外围）。而后以新建的名字空间为当前名字空间，在这个新环境中执行函数体。函数退出时，为其建立新的名字空间被抛弃，环境回到调用前的布局，随后的语句在恢复的环境中继续执行。

## 4.1.4 模块和环境
参考:https://docs.python.org/3/tutorial/modules.html#standard-modules
http://www.runoob.com/python/python-modules.html

* Python解释器把人写好的Python程序文件看作模块。一个模块可以直接执行，也可以在其他模块的执行中被导入。
* [Python类、模块、包的区别](https://www.cnblogs.com/kex1n/p/5977051.html)
    - 模块属性__name__，它的值由Python解释器设定。如果脚本文件是作为主程序调用，其值就设为__main__，如果是作为模块被其他文件导入，它的值就是其文件名。
    - from module import * 不建议使用，不清楚导入了什么符号，有可能覆盖自己定义的东西。
    - 涉及到了*模块搜索路径*
    - 涉及到了包的概念以及包的几种导入方法
    - 涉及到了__init__，抽空了解一下。
    - 包是一个包含__init__.py 文件的目录，该目录下一定得有这个__init__.py文件和其它模块或子包。
    - 好的建议：
        + 经常使用if __name__ == '__main__'，保证你写包既可以import又可以独立运行，用于test。
        + 多次import不会多次执行模块，只会执行一次。可以使用reload来强制运行模块，但不提倡。
    - 这篇文章前面不错，后面有些重复，而且有些地方也没有太详细解释，里面不懂得的地方再去查一下。
### 执行模块
* IDLE编辑窗口的run菜单的run module命令（快捷键为F5）就是要求把当前编辑文件的内容作为模块运行。(这里不太懂书上讲的)
* 我们常用的模块运行方式有两种：独立运行 或者是在IDLE或其他开发环境里运行（通常在程序开发阶段）
* [Python基础：Python运行的两种基本方式](https://blog.csdn.net/mrs_wu/article/details/79254627)
* [Python运行的方式](https://www.cnblogs.com/chaoguo1234/p/9126056.html)
* [廖雪峰 使用模块](https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431845183474e20ee7e7828b47f7b7607f2dc1e90dbb000)
* [python基础8之自定义模块、if __name__==__main__:解释](https://www.cnblogs.com/wdliu/p/6507668.html)
* [如何简单地理解Python中的if __name__ == '__main__'](https://blog.csdn.net/yjk13703623757/article/details/77918633)
* [python编程中的if __name__ == 'main': 的作用和原理](http://www.dengfeilong.com/post/60.html)
